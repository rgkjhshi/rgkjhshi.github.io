---
layout: blog
title:  事务的隔离级别
date:   2017-03-03
category: 编程技术
tag: sql
---



*****

* TOC
{:toc}

*****
在标准的SQL规范中，定义了4个事务隔离级别。

![隔离级别]({{ "/static/images/isolation.png"  | prepend: site.baseurl }} "隔离级别")

## 未授权读取(RU)
未授权读取也被称作读未提交(`Read Uncommitted`)，这种隔离级别允许读取未提交的数据，隔离级别最低。  
`RU`这种隔离级别中允许出现`脏读`。

`脏读`的解释: 事务A把一数据从1`update`成2,`update`成3直到`update`成9, 事务B每次`select`都能看到事务A的中间值(比如2,3或7)，对B来说这些就是脏数据。

## 授权读取(RC)
授权读取也被称为读已提交(`Read Committed`)，这种隔离级别只允许读取已经被提交的数据。  
`RC`这种隔离级别中允许出现`不可重复读`  

`不可重复读`的解释: 事务A操作数据1, 要把它`update`成9, 事务B第一次`select`发现是1, 此时事务A提交了, 事务B再次`select`发现变成了9, 这种现象叫做`不可重复读`。   
它的危害也很明显, 因为B第一次读取的时候是1, 若果要对它进行+1在更新回去, 就会变成2, 但实际上这是不对的。(这里你不能用mysql做实验, 因为mysql不再这个隔离级别, 所以这种情况在mysql中不会发生)

## 可重复读取(RR)
可重复读取(Repeatable Read), 这种隔离级别保证在一个事务中，多次读取到的数据都是和事务开始时是一样的。  
`RR`这种隔离级别禁止了`脏读`和`不可重复读`, 但允许出现`幻读`。

`幻读`的解释: 其实`幻读`和`不可重复读`都属于脏数据, 只不过对`脏读`进行了更细一步的划分。而`幻读`也属于`不可重复读`, 只不过又进行了进一步的划分。 `幻读`是指在同一个事务中不同时间对同一个数据的读取可能出现不一致的结果(这貌似跟`不可重复读`差不多,但`不可重复读`说的是同一个数据的值改变了)。在`RR`中, 事务B读取到的数据值都是跟事务开始时一致(所以可以重复读), 但若事务A新`insert`了一条数据, 事务B是可见的,因此对于事务B来说，开始时没有这个数据，但是过了一会儿却多出来一条数据(数据不一致了)，因此对于事务B来说就很莫名其妙。  

MySql就是在`RR`隔离级别上的, 但它在此基础上又加了`gap`锁, 保证了不会出现`幻读`。其实MySql中并没有区分`不可重复读`和`幻读`,MySql统称为`幻读`并且禁止了`幻读`现象的出现。

## 串行化(S)
串行化(Serializable)是最严格的事务隔离级别，它要求所有的事务都被串行执行。

*****
