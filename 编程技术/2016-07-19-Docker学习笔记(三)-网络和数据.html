<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="keywords" content="Docker学习笔记(三):网络和数据, 编程技术, Docker, 逆水行舟" />
    <meta name="description" content="Docker学习笔记(三):网络和数据, 编程技术, Docker, 通过Docker命令行客户端使用Docker的一些例子" />

    <title>逆水行舟</title>

    <!-- ico图标 -->
    <link rel="shortcut icon" type="image/x-icon" media="screen" href="/static/favicon.ico" />
    <!-- 搜索引擎收入相关 -->
    <link rel="canonical" href="http://loveshisong.cn/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/2016-07-19-Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)-%E7%BD%91%E7%BB%9C%E5%92%8C%E6%95%B0%E6%8D%AE.html" />
    <!-- rss输出源 -->
    <link rel="alternate" type="application/rss+xml" title="逆水行舟" href="http://loveshisong.cn/feed.xml"  />
    <!-- jquery -->
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.11.3/jquery.js"></script>
    <!-- qrcode -->
    <script type="text/javascript" src="/static/js/jquery.qrcode.min.js"></script>
    <!-- UK core js -->
    <script type="text/javascript" src="/static/js/uikit.min.js"></script>
    <!-- quietflow -->
    <!-- <script type="text/javascript" src="http://loveshisong.cn/static/js/quietflow.min.js"></script> -->
    <!-- UK sticky -->
    <script type="text/javascript" src="/static/js/components/sticky.min.js"></script>
    <!-- 本站js -->
    <script type="text/javascript" src="/static/js/script.js"></script>
    <!-- uk css-->
    <link rel="stylesheet" type="text/css" href="/static/css/uikit.min.css" />
    <!-- 基本样式 -->
    <link rel="stylesheet" type="text/css" href="/static/css/base.css" />
    <!-- 本站样式 -->
    <link rel="stylesheet" type="text/css" href="/static/css/main.css" />
    <!-- 代码高亮 -->
    <link rel="stylesheet" type="text/css" href="/static/css/highlight.css" />

    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
        var duoshuoQuery = {
            short_name: "shisong"
        };
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';
            ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共JS代码 end -->
</head>


<body>

    <header class="header" data-uk-sticky>
    <!-- 导航栏 -->
    <div class="uk-container uk-container-center">
        <div class="headwapper">
            <div class="navbar uk-float-left">
                <a class="uk-navbar-brand uk-hidden-small" href="http://loveshisong.cn"> 逆水行舟 -- Michael King's Blog </a>
                <a class="uk-visible-small uk-icon-home uk-icon-large" href="http://loveshisong.cn"></a>
            </div>
            <div class="navbar uk-float-right">
                <ul class="navbar-nav">
                    <li><a href="/pages/archive.html" title="归档" class="uk-icon-folder uk-icon-small"></a></li>
                    <li><a href="/pages/categories.html" title="目录分类" class="uk-icon-list uk-icon-small"></a></li>
                    <li><a href="/pages/tags.html" title="标签" class="uk-icon-tags uk-icon-small"></a></li>
                    <li><a href="/pages/about.html" title="About Me" class="uk-icon-user uk-icon-small"></a></li>
                    <li><a href="https://github.com/rgkjhshi" title="Github" class="uk-icon-github uk-icon-small"></a></li>
                    <li><a href="/feed.xml" title="RSS" class="uk-icon-rss uk-icon-small"></a></li>
                </ul>
            </div>
        <div>
    </div>
</header>
<!-- header end -->


    <div class="uk-container uk-container-center">
        <script type="text/javascript">
jQuery(function(){
	jQuery('#qrcode').qrcode({
        width: 150,
        height: 150,
        text: "http://loveshisong.cn/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/2016-07-19-Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)-%E7%BD%91%E7%BB%9C%E5%92%8C%E6%95%B0%E6%8D%AE.html"
    });
})
</script>
<!-- 日志默认模板 -->
<div class="uk-container content">
    <div class="page-title">
        <h1>Docker学习笔记(三):网络和数据</h1>
    </div>
    <div class="uk-grid">
        <div  class="uk-width-4-4">
            <div id="qrcode" class="uk-float-right uk-thumbnail"></div>
            <p>通过<code class="highlighter-rouge">Docker</code>命令行客户端使用<code class="highlighter-rouge">Docker</code>的一些例子</p>

<hr />

<ul id="markdown-toc">
  <li><a href="#section">网络</a>    <ul>
      <li><a href="#section-1">列出网络</a></li>
      <li><a href="#section-2">查看网络信息</a></li>
      <li><a href="#section-3">断开网络</a></li>
      <li><a href="#section-4">创建网络</a></li>
      <li><a href="#section-5">使用自定义网络创建容器</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="section">网络</h2>

<p>之前有个web程序的例子已经介绍过了端口, 这里说下网络</p>

<h3 id="section-1">列出网络</h3>

<p>每个<code class="highlighter-rouge">Docker</code>引擎默认都会包含三个默认的网络, 我们可以这样查看:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
5fa52100eeb6        bridge              bridge              local
e3b7da4f14e9        host                host                local
6ddc3eda6788        none                null                local
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">NAME</code>为<code class="highlighter-rouge">bridge</code>的网络比较特殊, 新运行的容器默认都是在这个网络中, 除非指定是用别的网络</li>
</ul>

<h3 id="section-2">查看网络信息</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>$ docker run -itd --name=networktest ubuntu
408cf6d9f25b9757c5d5fdfcd8c9a7133c7b888095c02b7b85d46f8df404b847
$ docker network inspect bridge
</code></pre>
</div>
<p>我们会得到类似于下面的描述</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"Name"</span><span class="p">:</span> <span class="s2">"bridge"</span><span class="p">,</span>
        <span class="s2">"Id"</span><span class="p">:</span> <span class="s2">"5fa52100eeb64d58d5ec97b2f2267c78d700265d310030b0bc61e203367172d2"</span><span class="p">,</span>
        <span class="s2">"Scope"</span><span class="p">:</span> <span class="s2">"local"</span><span class="p">,</span>
        <span class="s2">"Driver"</span><span class="p">:</span> <span class="s2">"bridge"</span><span class="p">,</span>
        <span class="s2">"EnableIPv6"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s2">"IPAM"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"Driver"</span><span class="p">:</span> <span class="s2">"default"</span><span class="p">,</span>
            <span class="s2">"Options"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="s2">"Config"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"Subnet"</span><span class="p">:</span> <span class="s2">"172.17.0.0/16"</span><span class="p">,</span>
                    <span class="s2">"Gateway"</span><span class="p">:</span> <span class="s2">"172.17.0.1"</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"Internal"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s2">"Containers"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"408cf6d9f25b9757c5d5fdfcd8c9a7133c7b888095c02b7b85d46f8df404b847"</span><span class="err">:</span> <span class="p">{</span>
                <span class="s2">"Name"</span><span class="err">:</span> <span class="s2">"networktest"</span><span class="p">,</span>
                <span class="s2">"EndpointID"</span><span class="err">:</span> <span class="s2">"87625c710a97b0e40dd79119d5002edd4c44f162ff1c2d4b85d9c87b0f43968e"</span><span class="p">,</span>
                <span class="s2">"MacAddress"</span><span class="err">:</span> <span class="s2">"02:42:ac:11:00:02"</span><span class="p">,</span>
                <span class="s2">"IPv4Address"</span><span class="err">:</span> <span class="s2">"172.17.0.2/16"</span><span class="p">,</span>
                <span class="s2">"IPv6Address"</span><span class="err">:</span> <span class="s2">""</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">"Options"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"com.docker.network.bridge.default_bridge"</span><span class="err">:</span> <span class="s2">"true"</span><span class="p">,</span>
            <span class="s2">"com.docker.network.bridge.enable_icc"</span><span class="err">:</span> <span class="s2">"true"</span><span class="p">,</span>
            <span class="s2">"com.docker.network.bridge.enable_ip_masquerade"</span><span class="err">:</span> <span class="s2">"true"</span><span class="p">,</span>
            <span class="s2">"com.docker.network.bridge.host_binding_ipv4"</span><span class="err">:</span> <span class="s2">"0.0.0.0"</span><span class="p">,</span>
            <span class="s2">"com.docker.network.bridge.name"</span><span class="err">:</span> <span class="s2">"docker0"</span><span class="p">,</span>
            <span class="s2">"com.docker.network.driver.mtu"</span><span class="err">:</span> <span class="s2">"1500"</span>
        <span class="p">},</span>
        <span class="s2">"Labels"</span><span class="err">:</span> <span class="p">{}</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre>
</div>
<p>我们可以这样检查容器的信息, 其中就有网络信息</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># 查看网络信息</span>
<span class="gp">$ </span>docker inspect --format<span class="o">=</span><span class="s1">''</span> networktest
<span class="o">{</span><span class="s2">"bridge"</span>:<span class="o">{</span><span class="s2">"IPAMConfig"</span>:null,<span class="s2">"Links"</span>:null,<span class="s2">"Aliases"</span>:null,<span class="s2">"NetworkID"</span>:<span class="s2">"5fa52100eeb64d58d5ec97b2f2267c78d700265d310030b0bc61e203367172d2"</span>,<span class="s2">"EndpointID"</span>:<span class="s2">"87625c710a97b0e40dd79119d5002edd4c44f162ff1c2d4b85d9c87b0f43968e"</span>,<span class="s2">"Gateway"</span>:<span class="s2">"172.17.0.1"</span>,<span class="s2">"IPAddress"</span>:<span class="s2">"172.17.0.2"</span>,<span class="s2">"IPPrefixLen"</span>:16,<span class="s2">"IPv6Gateway"</span>:<span class="s2">""</span>,<span class="s2">"GlobalIPv6Address"</span>:<span class="s2">""</span>,<span class="s2">"GlobalIPv6PrefixLen"</span>:0,<span class="s2">"MacAddress"</span>:<span class="s2">"02:42:ac:11:00:02"</span><span class="o">}}</span>
<span class="c"># 直接查看IP地址</span>
<span class="gp">$ </span>docker inspect --format<span class="o">=</span><span class="s1">''</span> networktest
172.17.0.2
</code></pre>
</div>

<h3 id="section-3">断开网络</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>$ docker network disconnect bridge networktest
</code></pre>
</div>
<p>把<code class="highlighter-rouge">networktest</code>这个容器从<code class="highlighter-rouge">bridge</code>网络中断开, 再次查看IP地址就没没有ip了</p>

<p>当然也可以重新连接</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ docker network connect bridge networktest
</code></pre>
</div>

<h3 id="section-4">创建网络</h3>
<p>我们可以这样创建一个<code class="highlighter-rouge">bridge</code>网络</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ docker network create -d bridge my-bridge
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">-d</code>: driver value, 可以不写, 默认就是<code class="highlighter-rouge">bridge</code>; 最后面跟自己的driver名字</li>
</ul>

<h3 id="section-5">使用自定义网络创建容器</h3>

<p>在运行容器的时候可以通过传递参数<code class="highlighter-rouge">--network=my-bridge</code>来指定使用那个网络, 不传默认使用<code class="highlighter-rouge">bridge</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>docker run -d --network<span class="o">=</span>my-bridge --name db training/postgres
<span class="gp">$ </span>docker run -d --name web training/webapp python app.py
<span class="c"># db 使用的网络是 my-bridge</span>
<span class="gp">$ </span>docker inspect --format<span class="o">=</span><span class="s1">''</span> db
172.18.0.2
<span class="c"># web 使用的网络是 bridge</span>
<span class="gp">shisong$ </span>docker inspect --format<span class="o">=</span><span class="s1">''</span> web
172.17.0.2
</code></pre>
</div>
<p>我们可以打开容器<code class="highlighter-rouge">db</code>的终端, <code class="highlighter-rouge">ping</code>一下看看网是否通</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ docker exec -it db bash
root@822d3512fe8d:/# ping 172.17.0.2
PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.
64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.114 ms
64 bytes from 172.18.0.2: icmp_seq=2 ttl=64 time=0.070 ms
^C
--- 172.18.0.2 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1006ms
</code></pre>
</div>
<p>如果我们把<code class="highlighter-rouge">web</code>容器也连接到<code class="highlighter-rouge">my-bridge</code>网络中, 则网络就通了</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>docker network connect my-bridge web
<span class="c"># 查看新的IP地址, 刚才的网络没断开, 所以会看到有两个网络, 两个IP地址(新的是172.18.0.3)</span>
<span class="gp">$ </span>docker inspect web
<span class="gp">$ </span>docker <span class="nb">exec</span> -it db bash
<span class="gp">root@822d3512fe8d:/# </span>ping 172.18.0.3
PING 172.18.0.3 <span class="o">(</span>172.18.0.3<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 172.18.0.3: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.298 ms
64 bytes from 172.18.0.3: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.112 ms
^C
--- 172.18.0.3 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, <span class="nb">time </span>999ms
</code></pre>
</div>

<hr />

        </div>
    </div>

    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <div class="ds-thread" data-thread-key="/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Docker学习笔记(三):网络和数据" data-title="Docker学习笔记(三):网络和数据" data-url="/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/2016-07-19-Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)-%E7%BD%91%E7%BB%9C%E5%92%8C%E6%95%B0%E6%8D%AE.html"></div>
    <!-- 多说评论框 end -->
</div>

    </div>

    <!-- 回到顶部 -->
    <div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
        <a href="javascript:void(0);">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>

    <footer class="footer">
    <!-- 导航栏 -->
    <div class="uk-container uk-container-center">
        <div class="uk-container footwapper">
            <div class="uk-grid">
                <div class="uk-width-1-3 uk-text-center">
                    <span class="foot-text"> 京ICP备14015515号-1 </span>
                </div>
                <div class="uk-width-1-3 uk-text-center">
                    <span class="foot-text">
                        <a href="http://www.amazingcounters.com"><img border="0" src="http://cc.amazingcounters.com/counter.php?i=3195706&c=9587431" alt="AmazingCounters.com"></a>
                    </span>
                </div>
                <div class="uk-width-1-3 uk-text-center">
                <span class="foot-text"> <i class="uk-icon-copyright"></i>2015 Michael King. </span>
                </div>
                <div class="uk-hidden">
                    <span class="foot-text">
                        <!-- cnzz统计工具 -->
                        <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254308303'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1254308303%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
                    </span>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- footer end -->


</body>

</html>
