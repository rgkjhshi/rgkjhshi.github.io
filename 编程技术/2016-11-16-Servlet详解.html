<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="keywords" content="Servlet详解, 编程技术, Spring, 逆水行舟" />
    <meta name="description" content="Servlet详解, 编程技术, Spring, " />

    <title>逆水行舟</title>

    <!-- ico图标 -->
    <link rel="shortcut icon" type="image/x-icon" media="screen" href="/static/favicon.ico" />
    <!-- 搜索引擎收入相关 -->
    <link rel="canonical" href="http://loveshisong.cn/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/2016-11-16-Servlet%E8%AF%A6%E8%A7%A3.html" />
    <!-- rss输出源 -->
    <link rel="alternate" type="application/rss+xml" title="逆水行舟" href="http://loveshisong.cn/feed.xml"  />
    <!-- jquery -->
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.11.3/jquery.js"></script>
    <!-- qrcode -->
    <script type="text/javascript" src="/static/js/jquery.qrcode.min.js"></script>
    <!-- UK core js -->
    <script type="text/javascript" src="/static/js/uikit.min.js"></script>
    <!-- quietflow -->
    <!-- <script type="text/javascript" src="http://loveshisong.cn/static/js/quietflow.min.js"></script> -->
    <!-- UK sticky -->
    <script type="text/javascript" src="/static/js/components/sticky.min.js"></script>
    <!-- 本站js -->
    <script type="text/javascript" src="/static/js/script.js"></script>
    <!-- uk css-->
    <link rel="stylesheet" type="text/css" href="/static/css/uikit.min.css" />
    <!-- 基本样式 -->
    <link rel="stylesheet" type="text/css" href="/static/css/base.css" />
    <!-- 本站样式 -->
    <link rel="stylesheet" type="text/css" href="/static/css/main.css" />
    <!-- 代码高亮 -->
    <link rel="stylesheet" type="text/css" href="/static/css/highlight.css" />

    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
        var duoshuoQuery = {
            short_name: "shisong"
        };
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';
            ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共JS代码 end -->
</head>


<body>

    <header class="header" data-uk-sticky>
    <!-- 导航栏 -->
    <div class="uk-container uk-container-center">
        <div class="headwapper">
            <div class="navbar uk-float-left">
                <a class="uk-navbar-brand uk-hidden-small" href="http://loveshisong.cn"> 逆水行舟 -- Michael King's Blog </a>
                <a class="uk-visible-small uk-icon-home uk-icon-large" href="http://loveshisong.cn"></a>
            </div>
            <div class="navbar uk-float-right">
                <ul class="navbar-nav">
                    <li><a href="/pages/archive.html" title="归档" class="uk-icon-folder uk-icon-small"></a></li>
                    <li><a href="/pages/categories.html" title="目录分类" class="uk-icon-list uk-icon-small"></a></li>
                    <li><a href="/pages/tags.html" title="标签" class="uk-icon-tags uk-icon-small"></a></li>
                    <li><a href="/pages/about.html" title="About Me" class="uk-icon-user uk-icon-small"></a></li>
                    <li><a href="https://github.com/rgkjhshi" title="Github" class="uk-icon-github uk-icon-small"></a></li>
                    <li><a href="/feed.xml" title="RSS" class="uk-icon-rss uk-icon-small"></a></li>
                </ul>
            </div>
        <div>
    </div>
</header>
<!-- header end -->


    <div class="uk-container uk-container-center">
        <script type="text/javascript">
jQuery(function(){
	jQuery('#qrcode').qrcode({
        width: 150,
        height: 150,
        text: "http://loveshisong.cn/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/2016-11-16-Servlet%E8%AF%A6%E8%A7%A3.html"
    });
})
</script>
<!-- 日志默认模板 -->
<div class="uk-container content">
    <div class="page-title">
        <h1>Servlet详解</h1>
    </div>
    <div class="uk-grid">
        <div  class="uk-width-4-4">
            <div id="qrcode" class="uk-float-right uk-thumbnail"></div>
            <hr />

<ul id="markdown-toc">
  <li><a href="#servlet" id="markdown-toc-servlet">Servlet</a>    <ul>
      <li><a href="#servlet生命周期" id="markdown-toc-servlet生命周期">Servlet生命周期</a></li>
      <li><a href="#servlet配置" id="markdown-toc-servlet配置">Servlet配置</a></li>
      <li><a href="#servletconfig" id="markdown-toc-servletconfig">ServletConfig</a></li>
      <li><a href="#servletcontext" id="markdown-toc-servletcontext">ServletContext</a></li>
    </ul>
  </li>
  <li><a href="#filter" id="markdown-toc-filter">Filter</a>    <ul>
      <li><a href="#filter生命周期" id="markdown-toc-filter生命周期">Filter生命周期</a></li>
      <li><a href="#装饰器模式decorator" id="markdown-toc-装饰器模式decorator">装饰器模式(decorator)</a></li>
    </ul>
  </li>
  <li><a href="#listener" id="markdown-toc-listener">Listener</a>    <ul>
      <li><a href="#servlet监听器" id="markdown-toc-servlet监听器">Servlet监听器</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="servlet">Servlet</h2>

<ul>
  <li><code class="highlighter-rouge">Servlet</code>是Sun公司提供的用于web开发的接口, 我们一般把实现了<code class="highlighter-rouge">Servlet</code>接口的程序称为<code class="highlighter-rouge">Servlet</code>程序</li>
  <li><code class="highlighter-rouge">Servlet</code>应该由web服务器调用(比如通过配置<code class="highlighter-rouge">web.xml</code>), 自己不能独立运行</li>
  <li><code class="highlighter-rouge">Servlet</code>接口有两个实现类<code class="highlighter-rouge">HttpServlet --&gt; GenericServlet</code>, <code class="highlighter-rouge">HttpServlet</code>重写了<code class="highlighter-rouge">service</code>方法, 根据请求方式自动调用<code class="highlighter-rouge">doGet</code>或<code class="highlighter-rouge">doPost</code>方法, 我们一般继承这个类, 重写<code class="highlighter-rouge">doGet、doPost</code>即可.</li>
</ul>

<h3 id="servlet生命周期">Servlet生命周期</h3>

<p><img src="/static/images/servlet.png" alt="Servlet生命周期" title="Servlet生命周期" /></p>

<p>如图:</p>

<ul>
  <li>图中画出的是第一次请求<code class="highlighter-rouge">Servlet</code>的情况, 若对应的<code class="highlighter-rouge">Servlet</code>对象还没被创建, 则创建<code class="highlighter-rouge">Servlet</code>对象</li>
  <li><code class="highlighter-rouge">Servlet</code>对象只初始化一次, 只会执行一次<code class="highlighter-rouge">init()</code>方法, <code class="highlighter-rouge">Servlet</code>初始化好之后, 新请求将直接到第5步</li>
  <li>第2步中解析出的应用对应<code class="highlighter-rouge">getContextPath</code>, 资源对应<code class="highlighter-rouge">getServletPath</code></li>
  <li>图中没画出<code class="highlighter-rouge">Servlet</code>的消亡, <code class="highlighter-rouge">Servlet</code>对象被创建后常驻内存, 继续为其他请求服务; web应用停止前调用<code class="highlighter-rouge">Servlet</code>的<code class="highlighter-rouge">destroy()</code>方法, <code class="highlighter-rouge">Servlet</code>生命周期才结束</li>
</ul>

<h3 id="servlet配置">Servlet配置</h3>

<ul>
  <li>上面的<code class="highlighter-rouge">Servlet</code>是有第一个请求时被创建, 可以在<code class="highlighter-rouge">web.xml</code>中通过<code class="highlighter-rouge">&lt;load-on-startup&gt;</code>元素指定在web容器启动时就直接初始化<code class="highlighter-rouge">Servlet</code></li>
  <li><code class="highlighter-rouge">Servlet</code>所映射的URL由<code class="highlighter-rouge">&lt;servlet-mapping&gt;</code>里的<code class="highlighter-rouge">&lt;url-pattern&gt;</code>指定, 它只有两个固定格式:
    <ol>
      <li><code class="highlighter-rouge">*.扩展名</code>, 如: <code class="highlighter-rouge">*.do</code></li>
      <li>以<code class="highlighter-rouge">/</code>开头(并以<code class="highlighter-rouge">/*</code>结尾), 如: <code class="highlighter-rouge">/abc</code>, <code class="highlighter-rouge">/abc/*</code></li>
    </ol>
  </li>
  <li>URL映射以最精确的为准, 请求<code class="highlighter-rouge">/abc</code>时, 映射<code class="highlighter-rouge">/abc</code>和<code class="highlighter-rouge">/abc/*</code>都可以匹配, 但优先选择<code class="highlighter-rouge">/abc</code>; 请求<code class="highlighter-rouge">/a.do</code>时,
<code class="highlighter-rouge">/*</code>和<code class="highlighter-rouge">*.do</code>都可以匹配, 但优先选择<code class="highlighter-rouge">/*</code>(即<code class="highlighter-rouge">/*</code>优先级高于<code class="highlighter-rouge">*.do</code>)</li>
</ul>

<h3 id="servletconfig">ServletConfig</h3>
<p>在<code class="highlighter-rouge">web.xml</code>中可以使用<code class="highlighter-rouge">&lt;init-param&gt;</code>标签为<code class="highlighter-rouge">Servlet</code>配置一些参数. <code class="highlighter-rouge">HttpServlet</code>类也实现了<code class="highlighter-rouge">ServletConfig</code>接口, 在创建<code class="highlighter-rouge">Servlet</code>对象时先把参数封装到<code class="highlighter-rouge">ServletConfig</code>对象中, 在调用<code class="highlighter-rouge">Servlet</code>的<code class="highlighter-rouge">init</code>方法时把<code class="highlighter-rouge">ServletConfig</code>对象传给<code class="highlighter-rouge">Servlet</code>.</p>

<p>在<code class="highlighter-rouge">Servlet</code>类中, 我们可以获取<code class="highlighter-rouge">ServletConfig</code>中的参数</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ServletConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getServletConfig</span><span class="o">();</span> <span class="c1">// 这个方法继承自GenericServlet</span>
<span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">"charset"</span><span class="o">);</span>  <span class="c1">// 这可获取我们配置的参数</span>
</code></pre></div></div>

<h3 id="servletcontext">ServletContext</h3>
<p><code class="highlighter-rouge">ServletContext</code>表示应用的上下文, 在Web容器在启动时, 会为每个Web应用程序都创建一个对应的<code class="highlighter-rouge">ServletContext</code>对象, 一个应用只有一个<code class="highlighter-rouge">ServletContext</code>对象, 被所有的<code class="highlighter-rouge">Servlet</code>共享.</p>

<p><code class="highlighter-rouge">ServletContext</code>的属性可以通过<code class="highlighter-rouge">web.xml</code>中的<code class="highlighter-rouge">&lt;context-param&gt;</code>标签来指定, 在程序中可以这样获取这些属性:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ServletConfig 里维护了 ServletContext 对象的引用</span>
<span class="n">ServletContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getServletConfig</span><span class="o">().</span><span class="na">getServletContext</span><span class="o">();</span>
<span class="c1">// 因为 Servlet类实现了 ServletConfig 接口, 所以也可以直接获取</span>
<span class="n">ServletContext</span> <span class="n">context1</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
<span class="c1">// 获取属性</span>
<span class="n">context</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"data"</span><span class="o">);</span>
<span class="c1">// 获取 &lt;display-name&gt; 标签配置的应用名</span>
<span class="n">context</span><span class="o">.</span><span class="na">getServletContextName</span><span class="o">();</span>
</code></pre></div></div>

<hr />

<h2 id="filter">Filter</h2>

<p><code class="highlighter-rouge">Servlet API</code>中提供了一个<code class="highlighter-rouge">Filter</code>接口, 称为过滤器, 所有的请求要先经过过滤器. web服务器在调用<code class="highlighter-rouge">Servlet</code>的<code class="highlighter-rouge">service()</code>方法之前会调用<code class="highlighter-rouge">Filter</code>的<code class="highlighter-rouge">doFilter()</code>方法.</p>

<p>web服务器把所有的<code class="highlighter-rouge">Filter</code>按注册顺序组成一个<code class="highlighter-rouge">filterChain</code>, 在调用<code class="highlighter-rouge">Filter</code>的<code class="highlighter-rouge">doFilter()</code>方法时, 会传递<code class="highlighter-rouge">filterChain</code>对象进来. <code class="highlighter-rouge">filterChain</code>也有个<code class="highlighter-rouge">doFilter</code>方法, 当调用<code class="highlighter-rouge">filterChain.doFilter()</code>时, web服务器会检查<code class="highlighter-rouge">filterChain</code>中是否还有<code class="highlighter-rouge">filter</code>, 如果有, 则调用下一个<code class="highlighter-rouge">filter</code>.</p>

<h3 id="filter生命周期">Filter生命周期</h3>
<p><code class="highlighter-rouge">Filter</code>的创建和销毁由web服务器负责. web服务器启动时创建<code class="highlighter-rouge">Filter</code>实例对象, 并调用其<code class="highlighter-rouge">init</code>方法, 完成对象的初始化, 为用户请求作好拦截的准备. <code class="highlighter-rouge">Filter</code>对象只创建一次, <code class="highlighter-rouge">init</code>方法只执行一次. <code class="highlighter-rouge">Filter</code>也有初始化参数, 被封装到<code class="highlighter-rouge">FilterConfig</code>中, 它有个方法<code class="highlighter-rouge">getServletContext()</code>可获取<code class="highlighter-rouge">ServletContext</code></p>

<h3 id="装饰器模式decorator">装饰器模式(decorator)</h3>
<p>在<code class="highlighter-rouge">Servlet API</code>中体现了一种设计模式: 装饰器模式</p>

<p>装饰器模式的实现步骤:</p>

<ol>
  <li>先看需要被增强对象实现了什么接口或继承了什么父类, 编写一个类也去继承这些接口或父类</li>
  <li>内部定义一个变量, 类型为被包装类的类型, 并提供一个构造函数用于接收被包装对象</li>
  <li>覆盖需要增强的方法, 添加增强内容</li>
  <li>实现接口中其他方法, 调用被包装对象的对应方法.</li>
</ol>

<p><code class="highlighter-rouge">Servlet API</code> 提供了一个<code class="highlighter-rouge">HttpServletRequestWrapper</code>类, 该类就是采用装饰器模式对<code class="highlighter-rouge">HttpServletRequest</code>进行了增强(实际上在内部仅调用了一下所包装的对象的对应方法).</p>

<hr />

<h2 id="listener">Listener</h2>
<p>全称是事件监听器<code class="highlighter-rouge">EventListener</code>, 全类名是<code class="highlighter-rouge">java.util.EventListener</code>, <code class="highlighter-rouge">Servlet API</code>中的监听器也是继承这个接口.</p>

<p>监听器是典型的 <strong>观察者模式</strong> , 使用监听器要了解三个概念:</p>

<ul>
  <li>事件源: 就是被监听的对象</li>
  <li>事件对象: 就是被监听的对象发生的动作, 封装成了一个事件对象. 比如增加了一个属性</li>
  <li>监听器: 对事件源发生的动作做出反应的对象. 由开发人员编写, 在事件监听器中, 可通过事件对象拿到事件源, 从而对事件源上的操作进行处理.</li>
</ul>

<h3 id="servlet监听器">Servlet监听器</h3>
<p><code class="highlighter-rouge">Servlet</code>中的监听器不是直接注册在事件源上的, 而是由由WEB容器负责注册.</p>

<p>在<code class="highlighter-rouge">Servlet</code>规范中定义了多种类型的监听器, 它们用于监听的事件源分别为<code class="highlighter-rouge">ServletContext</code>, <code class="highlighter-rouge">HttpSession</code>和<code class="highlighter-rouge">ServletRequest</code>这三个对象.</p>

<p>根据监听的类型不同, 又可分为:</p>

<ul>
  <li>监听事件源对象创建和销毁的事件监听器, 如: <code class="highlighter-rouge">ServletContextListener, HttpSessionListener, ServletRequestListener</code>.</li>
  <li>监听事件源对象属性添加和删除的事件监听器, 如: <code class="highlighter-rouge">ServletContextAttributeListener, HttpSessionAttributeListener, ServletRequestAttributeListener</code>.</li>
  <li>监听绑定到<code class="highlighter-rouge">HttpSession</code>中的对象的状态的事件监听器, 如: <code class="highlighter-rouge">HttpSessionBindingListener, HttpSessionActivationListener</code>, 这俩监听器比较特殊, 不需要在<code class="highlighter-rouge">web.xml</code>中进行注册</li>
</ul>

<hr />

        </div>
    </div>

    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <div class="ds-thread" data-thread-key="/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Servlet详解" data-title="Servlet详解" data-url="/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/2016-11-16-Servlet%E8%AF%A6%E8%A7%A3.html"></div>
    <!-- 多说评论框 end -->
</div>

    </div>

    <!-- 回到顶部 -->
    <div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
        <a href="javascript:void(0);">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>

    <footer class="footer">
    <!-- 导航栏 -->
    <div class="uk-container uk-container-center">
        <div class="uk-container footwapper">
            <div class="uk-grid">
                <div class="uk-width-1-3 uk-text-center">
                    <span class="foot-text"> 京ICP备14015515号-1 </span>
                </div>
                <div class="uk-width-1-3 uk-text-center">
                    <span class="foot-text">
                        <a href="http://www.amazingcounters.com"><img border="0" src="http://cc.amazingcounters.com/counter.php?i=3195706&c=9587431" alt="AmazingCounters.com"></a>
                    </span>
                </div>
                <div class="uk-width-1-3 uk-text-center">
                <span class="foot-text"> <i class="uk-icon-copyright"></i>2015 Michael King. </span>
                </div>
                <div class="uk-hidden">
                    <span class="foot-text">
                        <!-- cnzz统计工具 -->
                        <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254308303'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1254308303%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
                    </span>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- footer end -->


</body>

</html>
